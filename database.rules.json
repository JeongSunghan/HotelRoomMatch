{
    "rules": {
        "rooms": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$roomId": {
                ".validate": "!newData.exists() || newData.hasChild('guests')",
                "reservation": {
                    ".validate": "!newData.exists() || (newData.hasChildren(['reservedBy', 'reservedAt', 'expiresAt']) && newData.child('reservedBy').isString() && newData.child('reservedAt').isNumber() && newData.child('expiresAt').isNumber())"
                },
                "pending": {
                    ".validate": "!newData.exists() || (newData.hasChildren(['invitationId', 'inviterSessionId', 'createdAt', 'expiresAt', 'status']) && newData.child('invitationId').isString() && newData.child('inviterSessionId').isString() && newData.child('createdAt').isNumber() && newData.child('expiresAt').isNumber() && newData.child('status').isString())"
                }
            }
        },
        "users": {
            ".read": "auth != null",
            "$sessionId": {
                ".write": "auth != null",
                ".indexOn": [
                    "email"
                ],
                ".validate": "newData.hasChildren(['name', 'gender', 'sessionId'])"
            }
        },
        "allowedUsers": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$userId": {
                ".validate": "newData.hasChildren(['name', 'email'])"
            }
        },
        "roommateInvitations": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$invitationId": {
                ".validate": "newData.hasChildren(['inviterSessionId', 'inviteeName', 'roomNumber', 'status'])"
            }
        },
        "join_requests": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$requestId": {
                ".validate": "newData.hasChildren(['fromUserId', 'toRoomNumber', 'status'])"
            },
            ".indexOn": [
                "toUserId",
                "fromUserId",
                "status"
            ]
        },
        "roomChangeRequests": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$requestId": {
                ".validate": "newData.hasChildren(['sessionId', 'currentRoom', 'reason'])"
            }
        },
        "inquiries": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$inquiryId": {
                ".validate": "newData.hasChildren(['name', 'email', 'message', 'createdAt'])"
            }
        },
        "history": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$historyId": {
                ".validate": "newData.hasChildren(['action', 'timestamp'])"
            }
        },
        "tempGuests": {
            ".read": "auth != null",
            ".write": "auth != null",
            "$tempGuestId": {
                ".validate": "!newData.exists() || (newData.hasChildren(['tempGuestId','roomNumber','onsiteSessionId','name','gender','status','createdAt']) && newData.child('tempGuestId').isString() && newData.child('roomNumber').isString() && newData.child('onsiteSessionId').isString() && newData.child('name').isString() && newData.child('gender').isString() && newData.child('status').isString() && newData.child('createdAt').isNumber())"
            }
        },
        "settings": {
            ".read": true,
            ".write": "auth != null",
            ".validate": "newData.hasChildren(['deadline'])"
        },
        "otp_requests": {
            "$emailKey": {
                ".read": "auth != null",
                ".write": "auth != null",
                ".validate": "newData.hasChildren(['hashedCode', 'expiresAt', 'attempts'])"
            }
        }
    }
}